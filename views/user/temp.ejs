
<style>
    .custom-input {
      width: 100%;
      height: 3px; /* Adjust the height as needed */
      margin-bottom: 10px; /* Optional: Add some margin for better spacing */
    }
  
    .custom-checkbox {
      border: 1px solid #ccc; /* Add a light grey border */
      padding: 5px; /* Add some padding for better visibility */
      width: 20px;
      height: 20px;
      margin: 5px;
    }
  
    .form-check-label-sm {
      margin-left: 20px; /* Adjust spacing between checkbox and label */
    }
  </style>
  
  <section class="pt-150 pb-150">
    <div class="container">
      <div class="row">
        <div class="col-lg-10 m-auto">
          <div class="row">
            <div class="col-md-4">
              <!-- dashboard-menu -->
              <div class="dashboard-menu">
                <ul class="nav flex-column" role="tablist">
                  <li class="nav-item">
                    <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab" aria-controls="dashboard" aria-selected="false">
                      <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab" aria-controls="orders" aria-selected="false">
                      <i class="fi-rs-shopping-bag mr-10"></i>Orders
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#track-orders" role="tab" aria-controls="track-orders" aria-selected="false">
                      <i class="fi-rs-shopping-cart-check mr-10"></i>Track Your Order
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab" aria-controls="address" aria-selected="true">
                      <i class="fi-rs-marker mr-10"></i>My Address
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" id="account-detail-tab" data-bs-toggle="tab" href="#account-detail" role="tab" aria-controls="account-detail" aria-selected="true">
                      <i class="fi-rs-user mr-10"></i>Account details
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/logout">
                      <i class="fi-rs-sign-out mr-10"></i>Logout
                    </a>
                  </li>
                </ul>
              </div>
            </div>
  
            <div class="col-md-8">
              <div class="tab-content dashboard-content">
                <!-- Dashboard -->
                <div class="tab-pane fade active show" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Hello <%= user.firstName %> <%= user.lastName %></h5>
                    </div>
                    <div class="card-body">
                      <p>
                        From your account dashboard. you can easily check &amp;
                        view your <a href="#">recent orders</a>, manage your
                        <a href="#">shipping and billing addresses</a> and
                        <a href="#">edit your password and account details.</a>
                      </p>
                    </div>
                  </div>
                </div>
  
                <!-- Orders -->
                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Your Orders</h5>
                    </div>
                    <div class="card-body">
                      <div class="table-responsive">
                        <table class="table">
                          <thead>
                            <tr>
                              <th>Order</th>
                              <th>Date</th>
                              <th>Status</th>
                              <th>Total</th>
                              <th>Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>#1357</td>
                              <td>March 45, 2020</td>
                              <td>Processing</td>
                              <td>$125.00 for 2 item</td>
                              <td>
                                <a href="#" class="btn-small d-block">View</a>
                              </td>
                            </tr>
                            <tr>
                              <td>#2468</td>
                              <td>June 29, 2020</td>
                              <td>Completed</td>
                              <td>$364.00 for 5 item</td>
                              <td>
                                <a href="#" class="btn-small d-block">View</a>
                              </td>
                            </tr>
                            <tr>
                              <td>#2366</td>
                              <td>August 02, 2020</td>
                              <td>Completed</td>
                              <td>$280.00 for 3 item</td>
                              <td>
                                <a href="#" class="btn-small d-block">View</a>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
  
                <!-- Track Orders -->
                <div class="tab-pane fade" id="track-orders" role="tabpanel" aria-labelledby="track-orders-tab">
                  <div class="card">
                    <div class="card-header">
                      <h5 class="mb-0">Orders tracking</h5>
                    </div>
                    <div class="card-body contact-from-area">
                      <p>
                        To track your order please enter your OrderID in the box
                        below and press "Track" button. This was given to you on
                        your receipt and in the confirmation email you should have
                        received.
                      </p>
                      <div class="row">
                        <div class="col-lg-8">
                          <form class="contact-form-style mt-30 mb-50" action="#" method="post">
                            <div class="input-style mb-20">
                              <label>Order ID</label>
                              <input name="order-id" placeholder="Found in your order confirmation email" type="text" class="square" />
                            </div>
                            <div class="input-style mb-20">
                              <label>Billing email</label>
                              <input name="billing-email" placeholder="Email you used during checkout" type="email" class="square" />
                            </div>
                            <button class="submit submit-auto-width" type="submit">
                              Track
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
  
                <!-- Address Section -->
                <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                  <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center mb-2">
                      <h5 class="mb-0">Address</h5>
                      <!-- Add Address Button Triggering Modal -->
                      <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAddressModal">
                        <i class="">+</i> Add Address
                      </button>
                    </div>
                    <div class="row m-2">
                      <% if (addresses && addresses.length > 0) { %> <% addresses.forEach((address, index) => { %>
                      <div class="col-lg-6 mb-3">
                        <div class="card">
                          <div class="card-header">
                            <h5 class="mb-0">Address <%= index + 1 %></h5>
                          </div>
                          <div class="card-body">
                            <div>
                              <p>
                                <strong>House Number:</strong> <%= address.houseNumber %>
                              </p>
                              <p>
                                <strong>Street:</strong> <%= address.street %>
                              </p>
                              <p><strong>City:</strong> <%= address.city %></p>
                              <p>
                                <strong>Zipcode:</strong> <%= address.zipcode %>
                              </p>
                              <p>
                                <strong>Country:</strong> <%= address.country %>
                              </p>
                              <% if (address.landmark) { %>
                              <p>
                                <strong>Landmark:</strong> <%= address.landmark %>
                              </p>
                              <% } %> <% if (address.phoneNumber) { %>
                              <p>
                                <strong>Phone Number:</strong> <%= address.phoneNumber %>
                              </p>
                              <% } %>
                            </div>
                            <div class="btn-group" role="group">
                              <button type="button" class="btn btn-small btn-primary btn-edit" data-address-id="<%= address._id %>" data-address="<%= JSON.stringify(address) %>">
                                Edit
                              </button>
                              <button type="button" class="btn btn-small btn-danger btn-delete" data-address-id="<%= address._id %>">
                                Delete
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <% }); %> <% } else { %>
                      <p>No addresses found. Please add a new address.</p>
                      <% } %>
                    </div>
                  </div>
                </div>
  
                <!-- Account Details -->
                <div class="tab-pane fade" id="account-detail" role="tabpanel" aria-labelledby="account-detail-tab">
                  <div class="card">
                    <div class="card-header">
                      <h5>Account Details</h5>
                    </div>
                    <div class="card-body">
                       <form
                        id="changePasswordForm"
                        action="/user/updateUser"
                        method="POST"
                      >
                        <div class="row">
                          <div class="form-group col-md-6">
                            <label for="firstName" class="form-label text-left"
                              >First Name</label
                            >
                            <input
                              name="firstName"
                              type="text"
                              class="form-control"
                              id="firstName"
                              placeholder="First Name"
                              value="<%= user.firstName %>"
                            />
                            <small class="text-danger"></small>
                          </div>
                          <div class="form-group col-md-6">
                            <label for="lastName" class="form-label text-left"
                              >Last Name</label
                            >
                            <input
                              name="lastName"
                              type="text"
                              class="form-control"
                              id="lastName"
                              placeholder="Last Name"
                              value="<%= user.lastName %>"
                            />
                            <small class="text-danger"></small>
                          </div>
                          <div class="form-group col-md-12">
                            <label for="email" class="form-label text-left"
                              >Email</label
                            >
                            <input
                              name="email"
                              type="email"
                              class="form-control"
                              id="email"
                              value="<%= user.email %>"
                              placeholder="example@gmail.com"
                              disabled
                            />
                            <small class="text-danger"></small>
                          </div>
                          <div class="form-group col-md-12">
                            <label
                              for="currentPassword"
                              class="form-label text-left"
                              >Current Password</label
                            >
                            <div class="input-group">
                              <input
                                name="currentPassword"
                                type="password"
                                class="form-control"
                                id="currentPassword"
                                required
                              />
                              <div class="input-group-append">
                                <span
                                  class="input-group-text"
                                  onclick="togglePasswordVisibility('currentPassword')"
                                  ><i class="fa fa-eye"></i
                                ></span>
                              </div>
                            </div>
                          </div>
                          <div class="form-group col-md-12">
                            <label for="newPassword" class="form-label text-left"
                              >New Password</label
                            >
                              <div class="input-group">
                              <input
                                name="newPassword"
                                type="password"
                                class="form-control"
                                id="newPassword"
                                required
                              />
                              <div class="input-group-append">
                                <span
                                  class="input-group-text"
                                  onclick="togglePasswordVisibility('newPassword')"
                                  ><i class="fa fa-eye"></i
                                ></span>
                              </div>
                            </div>
                          </div>
                          <div class="form-group col-md-12">
                            <label
                              for="confirmPassword"
                              class="form-label text-left"
                              >Confirm Password</label
                            >
                            <div class="input-group">
                              <input
                                name="confirmPassword"
                                type="password"
                                class="form-control"
                                id="confirmPassword"
                                required
                              />
                              <div class="input-group-append">
                                <span
                                  class="input-group-text"
                                  onclick="togglePasswordVisibility('confirmPassword')"
                                  ><i class="fa fa-eye"></i
                                ></span>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-12">
                            <button
                              type="submit"
                              class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04"
                            >
                              Update
                            </button>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
  
                <!-- Edit Address Modal -->
                <div class="modal fade" id="editAddressModal" tabindex="-1" role="dialog" aria-labelledby="editAddressModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <form id="editAddressForm">
                          <input type="hidden" id="editAddressId" name="addressId" />
                          <div class="form-group">
                            <label for="editPlace">Place Name (e.g. Home, Office)</label>
                            <input type="text" class="form-control" id="editPlace" name="place" required />
                          </div>
                          <div class="form-group">
                            <label for="editHouseNumber">House Number</label>
                            <input type="text" class="form-control" id="editHouseNumber" name="houseNumber" required />
                          </div>
                          <div class="form-group">
                            <label for="editStreet">Street</label>
                            <input type="text" class="form-control" id="editStreet" name="street" required />
                          </div>
                          <div class="form-group">
                            <label for="editCity">City</label>
                            <input type="text" class="form-control" id="editCity" name="city" required />
                          </div>
                          <div class="form-group">
                            <label for="editZipcode">Zipcode</label>
                            <input type="text" class="form-control" id="editZipcode" name="zipcode" required />
                          </div>
                          <div class="form-group">
                            <label for="editCountry">Country</label>
                            <input type="text" class="form-control" id="editCountry" name="country" required />
                          </div>
                          <div class="form-group">
                            <label for="editLandmark">Landmark (optional)</label>
                            <input type="text" class="form-control" id="editLandmark" name="landmark" />
                          </div>
                          <div class="form-group">
                            <label for="editPhoneNumber">Phone Number (optional)</label>
                            <input type="tel" class="form-control" id="editPhoneNumber" name="phoneNumber" />
                          </div>
                          <button type="submit" class="btn btn-primary">Update Address</button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>    
  </section>
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
    <script>
      document.getElementById("changePasswordForm").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent form submission
  
        const firstName = document.getElementById("firstName").value;
        const lastName = document.getElementById("lastName").value;
        const currentPassword = document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("newPassword").value;
        const confirmPassword = document.getElementById("confirmPassword").value;
  
        if (newPassword !== confirmPassword) {
          Swal.fire({
            icon: "error",
            title: "Validation Error",
            text: "New passwords do not match",
          });
          return; // Exit function to prevent further execution
        }
  
        if (newPassword.length < 8 || !/[A-Z]/.test(newPassword) || !/[0-9]/.test(newPassword)) {
          Swal.fire({
            icon: "error",
            title: "Validation Error",
            text: "New password must be at least 8 characters long and contain at least one uppercase letter and one digit",
          });
          return; // Exit function to prevent further execution
        }
  
        fetch("/user/updateUser", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            firstName,
            lastName,
            currentPassword,
            newPassword,
            confirmPassword,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              Swal.fire({
                icon: "success",
                title: "Success",
                text: data.message,
              }).then(() => {
                window.location.href = "/user/profile"; // Redirect to user profile
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "Error",
                text: data.message,
              });
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            Swal.fire({
              icon: "error",
              title: "Server Error",
              text: "An error occurred while changing the password",
            });
          });
      });
  
      function togglePasswordVisibility(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = field.nextElementSibling.querySelector("i");
        if (field.type === "password") {
          field.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          field.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }
    </script>
   <script>
    $(document).ready(function() {
      // Handle Add Address Form Submission
      $('#addAddressForm').submit(function(event) {
        event.preventDefault();
        var formData = $(this).serialize();
  
        $.ajax({
          url: '/user/addAddress', // Adjust this URL based on your route
          method: 'POST',
          data: formData,
          success: function(response) {
            alert('Address added successfully');
            location.reload(); // Reload the page to update the list of addresses
          },
          error: function(error) {
            alert('Error adding address');
          }
        });
      });
  
      // Handle Edit Address Form Submission
      $('#editAddressForm').submit(function(event) {
        event.preventDefault();
        var formData = $(this).serialize();
  
        $.ajax({
          url: '/edit-address', // Adjust this URL based on your route
          method: 'POST',
          data: formData,
          success: function(response) {
            alert('Address updated successfully');
            location.reload(); // Reload the page to update the list of addresses
          },
          error: function(error) {
            alert('Error updating address');
          }
        });
      });
  
      // Populate Edit Address Modal with existing data
      $('#editAddressModal').on('show.bs.modal', function(event) {
        var button = $(event.relatedTarget);
        var addressId = button.data('address-id');
  
        // Use AJAX to fetch the address details
        $.ajax({
          url: '/get-address', // Adjust this URL based on your route
          method: 'GET',
          data: { addressId: addressId },
          success: function(data) {
            $('#editAddressId').val(data._id);
            $('#editPlace').val(data.place);
            $('#editHouseNumber').val(data.houseNumber);
            $('#editStreet').val(data.street);
            $('#editCity').val(data.city);
            $('#editZipcode').val(data.zipcode);
            $('#editCountry').val(data.country);
            $('#editLandmark').val(data.landmark);
            $('#editPhoneNumber').val(data.phoneNumber);
          },
          error: function(error) {
            alert('Error fetching address details');
          }
        });
      });
  
      // Handle Delete Address
      $('.delete-address-btn').click(function() {
        var addressId = $(this).data('address-id');
  
        if (confirm('Are you sure you want to delete this address?')) {
          $.ajax({
            url: '/delete-address', // Adjust this URL based on your route
            method: 'POST',
            data: { addressId: addressId },
            success: function(response) {
              alert('Address deleted successfully');
              location.reload(); // Reload the page to update the list of addresses
            },
            error: function(error) {
              alert('Error deleting address');
            }
          });
        }
      });
    });
  </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Handle edit button click
        document.addEventListener("click", function (event) {
          if (event.target && event.target.classList.contains("btn-edit")) {
            try {
              const address = JSON.parse(event.target.getAttribute("data-address"));
              if (address) {
                document.getElementById("editAddressId").value = address._id;
                document.getElementById("editPlace").value = address.place;
                document.getElementById("editHouseNumber").value = address.houseNumber;
                document.getElementById("editStreet").value = address.street;
                document.getElementById("editCity").value = address.city;
                document.getElementById("editZipcode").value = address.zipcode;
                document.getElementById("editCountry").value = address.country;
                document.getElementById("editLandmark").value = address.landmark || "";
                document.getElementById("editPhoneNumber").value = address.phoneNumber || "";
                $("#editAddressModal").modal("show");
              } else {
                console.error("Address data is not valid.");
              }
            } catch (e) {
              console.error("Error parsing address data:", e);
            }
          }
        });
  
        // Handle form submission
        document.getElementById("editAddressForm").addEventListener("submit", function (event) {
          event.preventDefault();
  
          const addressId = document.getElementById("editAddressId").value;
          const updatedAddress = {
            place: document.getElementById("editPlace").value,
            houseNumber: document.getElementById("editHouseNumber").value,
            street: document.getElementById("editStreet").value,
            city: document.getElementById("editCity").value,
            zipcode: document.getElementById("editZipcode").value,
            country: document.getElementById("editCountry").value,
            landmark: document.getElementById("editLandmark").value,
            phoneNumber: document.getElementById("editPhoneNumber").value,
          };
  
          fetch(`/user/address/${addressId}/edit`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedAddress),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                $("#editAddressModal").modal("hide");
                window.location.href = "/user/profile"; // Redirect to user profile
              } else {
                console.error("Update failed:", data.message);
              }
            })
            .catch((error) => console.error("Error:", error));
        });
      });
  
      document.addEventListener("click", function (event) {
        if (event.target && event.target.classList.contains("btn-delete")) {
          const addressId = event.target.getAttribute("data-address-id");
  
          fetch(`/user/address/${addressId}/delete`, {
            method: "DELETE",
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("Response:", data);
              if (data.success) {
                Swal.fire({
                  title: "Deleted!",
                  text: data.message,
                  icon: "success",
                  confirmButtonText: "OK",
                }).then(() => {
                  window.location.href = "/user/profile";
                });
              } else {
                Swal.fire({
                  title: "Error!",
                  text: data.message,
                  icon: "error",
                  confirmButtonText: "OK",
                });
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              Swal.fire({
                title: "Error!",
                text: "Something went wrong.",
                icon: "error",
                confirmButtonText: "OK",
              });
            });
        }
      });
  
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".btn-set-default").forEach((button) => {
          button.addEventListener("click", (event) => {
            event.preventDefault();
            const addressId = event.target.dataset.addressId;
            setAsDefault(addressId);
          });
        });
      });
  
      document.getElementById("set-default-btn").addEventListener("click", function () {
        const addressId = this.getAttribute("data-address-id");
  
        fetch(`/set-default-address/${addressId}`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              Swal.fire({
                title: "Success!",
                text: "Address set as default successfully.",
                icon: "success",
                confirmButtonText: "OK",
              }).then(() => {
                window.location.reload();
              });
            } else {
              Swal.fire({
                title: "Error!",
                text: data.message || "Failed to set address as default.",
                icon: "error",
                confirmButtonText: "Try Again",
              });
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            Swal.fire({
              title: "Error!",
              text: "An unexpected error occurred.",
              icon: "error",
              confirmButtonText: "Try Again",
            });
          });
      });
    </script>
  
  
  















































  


  
<section class="content-main">
  <ol class="breadcrumb">
      <% breadcrumbs.forEach(function(crumb, index) { %>
          <% if (index === breadcrumbs.length - 1) { %>
              <li class="breadcrumb-item active"><%= crumb.name %></li>
          <% } else { %>
              <li class="breadcrumb-item"><a href="<%= crumb.url %>"><%= crumb.name %></a></li>
          <% } %>
      <% }); %>
  </ol>
  <div class="row">
      <div class="col-9">
          <div class="content-header">
              <h2 class="content-title">Edit Product - <%= product.productName %>
              </h2>
          </div>
      </div>
  </div>
  <form id="editProductForm" action="/admin/edit-product/<%= product._id %>" method="post" enctype="multipart/form-data">
      <div class="row">
          <div class="col-lg-9">
              <div class="card mb-4">
                  <div class="card-body">
                      <!-- Product Name -->
                      <div class="mb-4">
                          <label for="product_name" class="form-label">Product Name</label>
                          <input type="text" value="<%= product.productName %>" placeholder="Type here"
                              class="form-control" name="productName" id="product_name">
                      </div>
  
                      <!-- Status -->
                      <div class="mb-4">
                          <label for="status" class="form-label">Status</label>
                          <select class="form-select" name="status" aria-label="List or Unlist">
                              <option value="true" <% if (!product.isActive) { %> selected <% } %>>Unlisted</option>
                              <option value="false" <% if (product.isActive) { %> selected <% } %>>Listed</option>
                          </select>
                      </div>
  
                      <!-- Categories -->
                      <div class="mb-4">
                          <label for="category_name" class="form-label">Categories</label>
                          <select name="categoryName" id="categoryName" class="form-select">
                              <option value="<%= product.category._id %>"><%= product.category.name %></option>
                              <% categories.forEach(category => { %>
                                  <% if (category._id.toString() !== product.category._id.toString()) { %>
                                      <option value="<%= category._id %>"><%= category.name %></option>
                                  <% } %>
                              <% }) %>
                          </select>
                      </div>
  
                      <!-- Full Description -->
                      <div class="mb-4">
                          <label class="form-label">Full Description</label>
                          <textarea placeholder="Type here" class="form-control" name="description" rows="4"><%= product.description %></textarea>
                      </div>
  
                      <!-- Stock -->
                      <div class="row">
                          <div class="col-lg-4">   
                              <div class="mb-4">
                                  <label class="form-label">Stock</label>
                                  <input placeholder="Enter stock" name="stock" value="<%= product.stock %>" type="number" class="form-control" min="0">
                              </div>
                          </div> 
                              <!-- Price -->
                          <div class="col-lg-4">     
                              <div class="mb-4">
                                  <label class="form-label">Price</label>
                                  <input placeholder="Enter price" value="<%= product.price %>" name="price" type="number" class="form-control" min="0">
                              </div>
                          </div>
                              <!-- Old Price -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Old Price</label>
                                  <input placeholder="₹" value="<%= product.oldPrice %>" type="number" name="oldPrice" class="form-control" min="0">
                              </div>
                          </div>
                              <!-- Colour -->
                          <div class="col-lg-4">      
                              <div class="mb-4">
                                  <label class="form-label">Colour</label>
                                  <input placeholder="Colour" value="<%= product.Colour %>" class="form-control" name="colour">
                              </div>
                          </div>
                              <!-- Display Size -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Display Size</label>
                                  <input placeholder="Enter display size" value="<%= product.displaySize %>" type="number" name="displaySize" class="form-control" min="0">
                              </div>
                          </div>
                              <!-- Resolution -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Resolution</label>
                                  <input placeholder="Enter resolution" value="<%= product.resolution %>" class="form-control" name="resolution">
                              </div>
                          </div>
                              <!-- Processor -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Processor</label>
                                  <select class="form-select" name="processor">
                                      <option value="Intel" <% if (product.Processor === 'Intel') { %> selected <% } %>>Intel</option>
                                      <option value="AMD" <% if (product.Processor === 'AMD') { %> selected <% } %>>AMD</option>
                                      <option value="Apple M1" <% if (product.Processor === 'Apple M1') { %> selected <% } %>>Apple M1</option>
                                      <option value="Qualcomm Snapdragon" <% if (product.Processor === 'Qualcomm Snapdragon') { %> selected <% } %>>Qualcomm Snapdragon</option>
                                      <option value="Samsung Exynos" <% if (product.Processor === 'Samsung Exynos') { %> selected <% } %>>Samsung Exynos</option>
                                  </select>
                              </div>
                          </div>
                              <!-- RAM Size -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">RAM Size</label>
                                  <select class="form-select" name="ramSize">
                                      <option value="4" <% if (product.ramSize === 4) { %> selected <% } %>>4 GB</option>
                                      <option value="8" <% if (product.ramSize === 8) { %> selected <% } %>>8 GB</option>
                                      <option value="16" <% if (product.ramSize === 16) { %> selected <% } %>>16 GB</option>
                                      <option value="32" <% if (product.ramSize === 32) { %> selected <% } %>>32 GB</option>
                                      <option value="64" <% if (product.ramSize === 64) { %> selected <% } %>>64 GB</option>
                                  </select>
                              </div>
                          </div>
                              <!-- Hard Drive Size -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Hard Drive Size</label>
                                  <select class="form-select" name="hardDriveSize">
                                      <option value="128" <% if (product.hardDriveSize === 128) { %> selected <% } %>>128 GB</option>
                                      <option value="256" <% if (product.hardDriveSize === 256) { %> selected <% } %>>256 GB</option>
                                      <option value="512" <% if (product.hardDriveSize === 512) { %> selected <% } %>>512 GB</option>
                                      <option value="1024" <% if (product.hardDriveSize === 1024) { %> selected <% } %>>1 TB</option>
                                      <option value="2048" <% if (product.hardDriveSize === 2048) { %> selected <% } %>>2 TB</option>
                                  </select>
                              </div>
                          </div>
                              <!-- Hard Disk Description -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Hard Disk Description</label>
                                  <select class="form-select" name="hardDiskDescription">
                                      <option value="HDD" <% if (product.hardDiskDescription === 'HDD') { %> selected <% } %>>HDD</option>
                                      <option value="SSD" <% if (product.hardDiskDescription === 'SSD') { %> selected <% } %>>SSD</option>
                                      <option value="Hybrid" <% if (product.hardDiskDescription === 'Hybrid') { %> selected <% } %>>Hybrid</option>
                                      <option value="NVMe" <% if (product.hardDiskDescription === 'NVMe') { %> selected <% } %>>NVMe</option>
                                  </select>
                              </div>
                          </div>
                              <!-- Graphics Chipset Brand -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Graphics Chipset Brand</label>
                                  <select class="form-select" name="graphics">
                                      <option value="NVIDIA" <% if (product.graphicsChipsetBrand === 'NVIDIA') { %> selected <% } %>>NVIDIA</option>
                                      <option value="AMD" <% if (product.graphicsChipsetBrand === 'AMD') { %> selected <% } %>>AMD</option>
                                      <option value="Intel" <% if (product.graphicsChipsetBrand === 'Intel') { %> selected <% } %>>Intel</option>
                                      <option value="Apple" <% if (product.graphicsChipsetBrand === 'Apple') { %> selected <% } %>>Apple</option>
                                      <option value="Non-Graphic" <% if (product.graphicsChipsetBrand === 'Non-Graphic') { %> selected <% } %>>Non-Graphic</option>
                                  </select>
                              </div>
                          </div>
                              <!-- Operating System -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Operating System</label>
                                  <select class="form-select" name="os">
                                      <option value="Windows" <% if (product.operatingSystem === 'Windows') { %> selected <% } %>>Windows</option>
                                      <option value="macOS" <% if (product.operatingSystem === 'macOS') { %> selected <% } %>>macOS</option>
                                      <option value="Linux" <% if (product.operatingSystem === 'Linux') { %> selected <% } %>>Linux</option>
                                      <option value="Chrome OS" <% if (product.operatingSystem === 'Chrome OS') { %> selected <% } %>>Chrome OS</option>
                                      <option value="Android" <% if (product.operatingSystem === 'Android') { %> selected <% } %>>Android</option>
                                  </select>
                              </div>
                          </div> 
                              <!-- Number of USB Ports -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Number of USB Ports</label>
                                  <input placeholder="Number of USB ports" value="<%= product.numberofUSB %>" type="number" name="numberofUSB" class="form-control" min="0">
                              </div>
                          </div>
                              <!-- Audio Details -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Audio Details</label>
                                  <input placeholder="Audio details" value="<%= product.audioDetails %>" class="form-control" name="audioDetails">
                              </div>
                          </div>
                              <!-- Country of Origin -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Country of Origin</label>
                                  <input placeholder="Country of origin" value="<%= product.countryofOrigin %>" class="form-control" name="countryofOrigin">
                              </div>
                          </div>
                              <!-- Item Weight -->
                          <div class="col-lg-4">
                              <div class="mb-4">
                                  <label class="form-label">Item Weight</label>
                                  <input placeholder="Item weight" value="<%= product.itemWeight %>" class="form-control" name="itemWeight">
                              </div>
                          </div>
                     </div>
                     <div class="row">
                        <!-- Primary image upload with cropping -->
                        <div class="col-lg-4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Primary Image</h4>
                                </div>
                                <div class="card-body text-center">
                                    <div class="input-upload">
                                        <label for="image1" class="form-label">
                                            <% if (product.primaryImages[0]) { %>
                                                <img id="preview1"
                                                    src="/uploads/products-images/crp/<%- product.primaryImages[0].name %>" alt=""
                                                    width="150px">
                                                <% } else {%>
                                                    <img id="preview1" src="../../assets/imgs/theme/upload.svg" alt=""
                                                        width="150px">
                                                    <% } %>
                                        </label>
                                        <input type="file" class="form-control" id="image1" name="primaryImage">
                                    </div>
                                    <button type="button" class="btn btn-md rounded font-sm"
                                        onclick="document.getElementById('image1').click();">Upload Image</button>
                                </div>
                            </div>
                        </div>
                        <!-- Secondary images upload -->
                        <div class="col-lg-4"> 
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Secondary Image 1</h4>
                                </div>
                                <div class="card-body text-center">
                                    <div class="input-upload">
                                        <label for="image2" class="form-label">
                                            <% if (product.secondaryImages[0]) { %>
                                                <img id="preview2"
                                                    src="/uploads/products-images/crp/<%-product.secondaryImages[0].name %>" alt=""
                                                    width="150px">
                                                <% } else {%>
                                                    <img id="preview2" src="../../assets/imgs/theme/upload.svg" alt=""
                                                        width="150px">
                                                    <% } %>
                                        </label>
                                        <input type="file" class="form-control" id="image2" name="image2">
                                    </div>
                                    <button type="button" class="btn btn-md rounded font-sm"
                                        onclick="document.getElementById('image2').click();">Upload Image</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Secondary Image 2</h4>
                                </div>
                                <div class="card-body text-center">
                                    <div class="input-upload">
                                        <label for="image3" class="form-label">
                                            <% if (product.secondaryImages[1]) { %>
                                                <img id="preview3"
                                                    src="/uploads/products-images/crp/<%-product.secondaryImages[1].name %>" alt=""
                                                    width="150px">
                                                <% } else {%>
                                                    <img id="preview3" src="../../assets/imgs/theme/upload.svg" alt=""
                                                        width="150px">
                                                    <% } %>
                                        </label>
                                        
                                        <input type="file" class="form-control" id="image3" name="image3">
                                    </div>
                                    <button type="button" class="btn btn-md rounded font-sm"
                                        onclick="document.getElementById('image3').click();">Upload Image</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4"> 
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>Secondary Image 3</h4>
                                </div>
                                <div class="card-body text-center">
                                    <div class="input-upload">
                                        <label for="image4" class="form-label">
                                            <% if (product.secondaryImages[0]) { %>
                                                <img id="preview4"
                                                    src="/uploads/products-images/crp/<%-product.secondaryImages[2].name %>" alt=""
                                                    width="150px">
                                                <% } else {%>
                                                    <img id="preview4" src="../../assets/imgs/theme/upload.svg" alt=""
                                                        width="150px">
                                                    <% } %>
                                        </label>
                                        <input type="file" class="form-control" id="image4" name="image4">
                                    </div>
                                    <button type="button" class="btn btn-md rounded font-sm"
                                        onclick="document.getElementById('image4').click();">Upload Image</button>
                                </div>
                            </div>
                        </div>
                  </div>
                  <div class="row">
                    <div class="col">
                        <button class="btn btn-md rounded font-sm" type="submit">Update</button>
                        <a href="/admin/products" class="btn btn-light rounded font-sm">Cancel</a>
                    </div>
                </div>
                </div> 
              </div>
          </div>
      </div>
  </form>
  
</section> <!-- content-main end// -->

<!-- Image Crop Modal -->
<div class="modal fade" id="imageCropModal" tabindex="-1" aria-labelledby="imageCropModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="imageCropModalLabel">Crop Image</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
              <img id="imageToCrop" src="" alt="Crop this image" style="max-width: 100%;">
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-primary" id="cropImageBtn">Crop</button>
          </div>
      </div>
  </div>
</div>
<style>
  .cropper-bg {
      max-width: 100%;
  }
</style>


<!-- Cropper.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.js"></script>
<script defer>
  let currentInputId, currentPreviewId, cropper;
  let croppedImages = {};
  let originalFileNames = {};

  document.addEventListener("DOMContentLoaded", function () {
      document.getElementById('image1').addEventListener('change', function () { prepareImageForCropping('image1', 'preview1'); });
      document.getElementById('image2').addEventListener('change', function () { prepareImageForCropping('image2', 'preview2'); });
      document.getElementById('image3').addEventListener('change', function () { prepareImageForCropping('image3', 'preview3'); });
      document.getElementById('image4').addEventListener('change', function () { prepareImageForCropping('image4', 'preview4'); });



      document.getElementById('cropImageBtn').addEventListener('click', function () {
          performCropping();
      });

      $('#imageCropModal').on('shown.bs.modal', function () {
          let image = document.getElementById('imageToCrop');
          cropper = new Cropper(image, {
              aspectRatio: 1,
              viewMode: 1,
              dragMode: "move",
              minContainerWidth: 450,
              minContainerHeight: 500,
              minCropBoxWidth: 400,
              minCropBoxHeight: 400,
              minCanvasHeight: 500,
              minCanvasWidth: 500,
          });
      });

      $('#imageCropModal').on('hidden.bs.modal', function () {
          if (cropper) {
              cropper.destroy();
              cropper = null;
          }
      });
  });

  function prepareImageForCropping(inputId, previewId) {
      currentInputId = inputId;
      currentPreviewId = previewId;
      const input = document.getElementById(inputId);
      const file = input.files[0];
      const newDate = new Date().getTime();
      originalFileNames[inputId] = `${ file.name }_${ newDate }`

      const reader = new FileReader();
      reader.onload = function (e) {
          document.getElementById('imageToCrop').src = e.target.result;
          $('#imageCropModal').modal('show');
      };
      reader.readAsDataURL(file);
  }

  function performCropping() {
      if (!cropper) {
          console.error("Cropper is not initialized.");
          return;
      }

      cropper.getCroppedCanvas().toBlob((blob) => {


          const previewId = currentPreviewId;
          const file = new File([blob], originalFileNames[currentInputId], { type: 'image/png' });

          const dataTransfer = new DataTransfer();
          dataTransfer.items.add(file);
          document.getElementById(currentInputId).files = dataTransfer.files;


          const preview = document.getElementById(currentPreviewId);

          preview.src = URL.createObjectURL(blob);


          croppedImages[currentInputId] = blob;
          $('#imageCropModal').modal('hide');


      }, 'image/png');

  }



</script>










