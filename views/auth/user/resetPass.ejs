<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
    .input-group {
        position: relative;
    }
    .input-group-append {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
    }
    .input-group-append i {
        font-size: 1.2em;
    }
    .is-invalid {
        border-color: red;
    }
    .invalid-feedback {
        display: none;
        color: red;
    }
    .is-invalid + .invalid-feedback {
        display: block;
    }
</style>

<section>
    <div class="px-4 py-5 px-md-5 text-center text-lg-start" style="background-color: hsl(0, 0%, 96%)">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h3 class="ltext-103 cl5 text-center mb-5">Reset Password</h3>
                </div>
            </div>
            <div class="row gx-lg-5 justify-content-center">
                <div class="col-lg-6 mb-5 mb-lg-0">
                    <div class="card">
                        <div class="card-body py-5 px-md-5">
                            <form id="resetForm" action="/resetPass" method="POST" novalidate>
                                <!-- Password input -->
                                <div class="form-outline mb-4">
                                    <label for="password" class="form-label text-left">New Password</label>
                                    <div class="input-group">
                                      <input
                                        name="password"
                                        type="password"
                                        class="form-control"
                                        id="password"
                                        required
                                      />
                                      <div class="input-group-append">
                                        <span
                                          class="input-group-text"
                                          onclick="togglePasswordVisibility('password')"
                                          ><i class="fa fa-eye"></i
                                        ></span>
                                      </div>
                                     </div>
                                    <div class="invalid-feedback" id="passwordError">Password must be at least 8 characters long, include 1 lowercase, 1 uppercase, 1 number, and 1 special character.</div>
                                </div>
                                <div class="form-outline mb-4">
                                    <label for="confirmPassword" class="form-label text-left">Confirm Password</label>
                                    <div class="input-group">
                                        <input name="confirmPassword" type="password" class="form-control" id="confirmPassword" required />
                                        <div class="input-group-append">
                                            <span class="input-group-text" onclick="togglePasswordVisibility('confirmPassword')"><i class="fa fa-eye"></i></span>
                                        </div>
                                    </div>
                                    <div class="invalid-feedback" id="confirmPasswordError">Passwords do not match.</div>
                                </div>
                                <!-- Verify button -->
                                <div class="flex-c-m">
                                    <button type="submit" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">Confirm</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("resetForm");
        const password = document.getElementById("password");
        const confirmPassword = document.getElementById("confirmPassword");
        const passwordError = document.getElementById("passwordError");
        const confirmPasswordError = document.getElementById("confirmPasswordError");

        const showError = (element, message) => {
            element.classList.add("is-invalid");
            element.nextElementSibling.textContent = message;
        };

        const clearError = (element) => {
            element.classList.remove("is-invalid");
            element.nextElementSibling.textContent = "";
        };

        const togglePasswordVisibility = (fieldId) => {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('i');
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        };

        form.addEventListener("submit", function (event) {
            event.preventDefault();
            event.stopPropagation();

            let isValid = true;

            const passwordValue = password.value;
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

            if (!passwordRegex.test(passwordValue)) {
                showError(password, "Password must be at least 8 characters, include 1 lowercase, 1 uppercase, 1 number, and 1 special character.");
                isValid = false;
            } else {
                clearError(password);
            }

            if (passwordValue !== confirmPassword.value) {
                showError(confirmPassword, "Passwords do not match.");
                isValid = false;
            } else {
                clearError(confirmPassword);
            }

            if (isValid) {
                form.submit();
            }
        });

        document.querySelectorAll('input[type="password"]').forEach(function (input) {
            input.addEventListener("input", function () {
                clearError(input);
            });
        });

        form.addEventListener("input", function (event) {
            if (event.target.checkValidity()) {
                event.target.classList.add("is-valid");
                event.target.classList.remove("is-invalid");
            } else {
                event.target.classList.add("is-invalid");
                event.target.classList.remove("is-valid");
            }
        });
    });
    function togglePasswordVisibility(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = field.nextElementSibling.querySelector('i');
        if (field.type === 'password') {
            field.type = 'text';
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        } else {
            field.type = 'password';
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        }
    }
</script>
